<div class="page-nav">
   
  <h1>Mi tienda</h1>
  <a href="/carts/{{user.cart}}"><button id="checkout" class="button-checkout">Carrito</button>
</div>
{{#unless user}}
<div class="text-center">

    <h1 class="page-nav-login">Logeate</h1>

    <form id="loginForm" >     
      

        <label>Email</label>
        <input name="email">

        <label>Contraseña</label>
        <input type="password" name="password">

        <input class="pages btn btn-sm btn-info"  type="submit">
    </form>
    <p>Olvidaste tu contraseña ? puedes <a href="/restoreRequest">Restaurala aqui</a></p>
    <p>Tambien Puedes Ingresar Por Github</p>
    <a href="/api/sessions/github"><button class="pages btn btn-sm btn-info" >github</button></a>
</div>
{{/unless}}
<div id="page-content" class="page-content">
  <div class="container "></div>
  <div class="container ">
    <div id="verProductsHome">
   {{#if user}}
    <div>
            <h1>Hola, {{user.name}}</h1>
            <p class="email" email={{user.email}}>Correo: {{user.email}}</p>
            <p class="userID" id={{user.id}}>ID: {{user.id}} </p>
            <p>Role: {{user.role}}</p>
            <p id={{user.cart}} class="idCarrito">Carrito: {{user.cart}}</p>
            <a href="/api/sessions/logout"><button class="pages btn btn-sm btn-info">Salir</button></a>
            <button class="pages btn btn-sm btn-info changeRol">Presione aqui para cambiar el Role a Premium o a USER</button>
    </div>
   {{/if}}
  </div>
    <!-- Table structure here -->
    <table class= "table table-dark mostrarProductosCart" id="our-table">
      <thead>
        <tr>
          <th>Ref</th>
          <th>Nombre</th>
          <th>Category</th>
          <th>Price</th>
        </tr>
      </thead>
      <tbody id="table-body">
      </tbody>
    </table>
  </div>
    
  <div class="container ">
    <div id="pagination-wrapper"></div>
  </div>
</div>

<script>
  const deleteButton = (id) => {
  // Aquí puedes realizar alguna acción para eliminar el producto
}

const getProduct = (page, orderBy) => {
  fetch(`/api/products?page=${page}&orderBy=${orderBy}`)
    .then(response => response.json())
    .then(data => {
      const tableBody = document.getElementById('table-body');
      tableBody.innerHTML = '';

      if (Array.isArray(data.payload.docs)) {
        const productList = data.payload.docs;

        productList.forEach(product => {
          const row = `
            <tr>
              <td>${product._id}</td>
              <td>${product.name}</td>
              <td>${product.category}</td>
              <td>${product.price}</td>
              <td><button class="pages btn btn-sm btn-info comprar-button" data-product-id="{{product._id}}">Comprar</button></td>
            </tr>
          `;
          tableBody.innerHTML += row;
        });
      } else {
        console.log('La propiedad "docs" no existe o no es un array');
      }

      pageButtons(data.payload, orderBy);
    })
    .catch(error => {
      console.log('Error al obtener los productos:', error);
    });
}



// Llama a la función getProduct inicialmente para mostrar los productos
getProduct(0,0);

function pageButtons(state, orderBy) { console.log("state",state, orderBy)
  var wrapper = document.getElementById('pagination-wrapper');
  wrapper.innerHTML = '';

  for (let page = 1; page <= state.totalPages; page++) {
    wrapper.innerHTML += `<button value=${page} class="page btn btn-sm btn-info" style=${page == state.page ? 'color:black;' : null}>${page}</button>`;
  }

  if (state.hasPrevPage) {
    wrapper.innerHTML = `<button value=${state.prevPage} class="page btn btn-sm btn-info">&#171; First</button>` + wrapper.innerHTML;
  }

  if (state.hasNextPage) {
    wrapper.innerHTML += `<button value=${state.nextPage} class="page btn btn-sm btn-info">Last &#187;</button>`;
  }

  wrapper.innerHTML += `<button class="pages btn btn-sm btn-info" onclick="getProduct(0, 0)">Limpiar</button>`;
  wrapper.innerHTML += `<button class="pages btn btn-sm btn-info" onclick="getProduct(0, -1)">Mayor precio</button>`;
  wrapper.innerHTML += `<button class="pages btn btn-sm btn-info" onclick="getProduct(0, 1)">Menor precio</button>`;

  $('.page').on('click', function() { 
    const page = Number($(this).val());
    getProduct(page, orderBy);
  });
}

  pageButtons(state);



</script>



<script src="/js/home.js"></script>

<script src="/js/login.js"></script>